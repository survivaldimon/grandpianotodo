# –°–µ—Å—Å–∏—è 25.12.2025 ‚Äî –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ä–∞–±–æ—Ç–µ

## –û–±–∑–æ—Ä

–°–µ–≥–æ–¥–Ω—è –±—ã–ª–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –º–∞—Å—à—Ç–∞–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é, Realtime —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∏ —Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞. –í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ **29 –∫–æ–º–º–∏—Ç–æ–≤**, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏—Ö —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å UI** ‚Äî —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
2. **Realtime —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
3. **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ permissions –¥–ª—è —á–ª–µ–Ω–æ–≤ –∑–∞–≤–µ–¥–µ–Ω–∏—è
4. **–ü–æ–¥–ø–∏—Å–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤** ‚Äî realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –∑–∞–Ω—è—Ç–∏–π
5. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî 4 –Ω–æ–≤—ã—Ö TestFlight –±–∏–ª–¥–∞ (1.0.0+10 –¥–æ 1.0.0+13)

---

## 1. –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é UI (–±–∏–ª–¥—ã 10-13)

### –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–±–ª–µ–º–µ:
> "–ü—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –µ—Å—Ç—å –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π delay. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –∞–Ω–∏–º–∞—Ü–∏—è, –º–æ–∂–Ω–æ —Å–≤–∞–π–ø–Ω—É—Ç—å"

### –†–µ—à–µ–Ω–∏–µ

**–ö–æ–º–º–∏—Ç—ã:**
- `5b89a89` ‚Äî fix: remove scroll animation delay in schedule views
- `82612a2` ‚Äî fix: add ClampingScrollPhysics to all vertical scrolls in schedule
- `9d34182` ‚Äî fix: enable scrolling on all week view rows with synchronization
- `024d2fa` ‚Äî fix: synchronize week view header with day rows scrolling

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**

1. **–ó–∞–º–µ–Ω–∞ ScrollPhysics:**
   ```dart
   // –ë—ã–ª–æ: default momentum scrolling
   physics: null

   // –°—Ç–∞–ª–æ: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫
   physics: const ClampingScrollPhysics()
   ```

2. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞ –≤ –Ω–µ–¥–µ–ª—å–Ω–æ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏:**
   ```dart
   void _syncFromDay(int sourceIndex) {
     if (_isSyncing) return;
     _isSyncing = true;

     final offset = _dayControllers[sourceIndex].offset;

     // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
     if (_headerScrollController.hasClients) {
       _headerScrollController.jumpTo(offset);
     }

     // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–Ω–∏
     for (int i = 0; i < _dayControllers.length; i++) {
       if (i != sourceIndex && _dayControllers[i].hasClients) {
         _dayControllers[i].jumpTo(offset);
       }
     }

     _isSyncing = false;
   }
   ```

3. **–î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
   - Header ‚Üí Days
   - Days ‚Üí Header
   - Days ‚Üí Other Days

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `lib/features/schedule/screens/schedule_screen.dart`
- `lib/features/schedule/screens/all_rooms_schedule_screen.dart`

**–ë–∏–ª–¥—ã:** 1.0.0+10, +11, +12, +13

---

## 2. Realtime —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞

–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–æ—Å—å –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:
- –ì–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–Ω—è—Ç–∏–µ ‚Üí –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —É –¥—Ä—É–≥–∏—Ö
- –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è ‚Üí –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —É –¥—Ä—É–≥–∏—Ö
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è ‚Üí —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –†–µ—à–µ–Ω–∏–µ

**–ö–æ–º–º–∏—Ç—ã:**
- `0843fa2` ‚Äî feat: realtime schedule updates and navigation fix
- `e3e8856` ‚Äî fix: force schedule refresh after lesson delete/update
- `8d0faa9` ‚Äî fix: realtime sync for lesson deletions across users
- `4e5385e` ‚Äî fix: remove filters from Supabase Realtime streams for proper sync

**–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:**

–£–¥–∞–ª–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ Realtime streams –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã DELETE —Å–æ–±—ã—Ç–∏–π:

```dart
// –ë–´–õ–û (DELETE —Å–æ–±—ã—Ç–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏):
Stream<List<Lesson>> watchByRoom(String roomId) {
  return _client
    .from('lessons')
    .stream(primaryKey: ['id'])
    .eq('room_id', roomId)  // ‚Üê –§–∏–ª—å—Ç—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª DELETE
    .map((data) => ...);
}

// –°–¢–ê–õ–û (—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ):
Stream<List<Lesson>> watchByRoom(String roomId) async* {
  await for (final _ in _client.from('lessons').stream(primaryKey: ['id'])) {
    // –ü—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    final lessons = await getByRoom(roomId);
    yield lessons;
  }
}
```

**–ü–∞—Ç—Ç–µ—Ä–Ω:** Stream —Å–ª—É—à–∞–µ—Ç –í–°–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö.

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `lib/features/schedule/repositories/lesson_repository.dart`
- `lib/features/schedule/screens/all_rooms_schedule_screen.dart`

---

## 3. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (Permissions)

### –ü—Ä–æ–±–ª–µ–º—ã

1. –ü—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—ã–ª–∏ `null` –¥–æ –ø–µ—Ä–≤–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î
2. –ü—Ä–∞–≤–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞–Ω—è—Ç–∏—è
3. –ü—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –∫ –∑–∞–≤–µ–¥–µ–Ω–∏—é –ø–æ –∫–æ–¥—É –Ω–µ –±—ã–ª–æ –ø—Ä–∞–≤ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞–º–∏
4. RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –†–µ—à–µ–Ω–∏–µ

**–ö–æ–º–º–∏—Ç—ã:**
- `bebc87b` ‚Äî feat: auto-grant student management permission on institution join
- `b076839` ‚Äî fix: implement realtime member permissions updates
- `671f298` ‚Äî fix: emit initial membership value before listening to changes
- `ecbfda7` ‚Äî fix: use direct Supabase access for currentUserId in permission checks
- `da18dcb` ‚Äî fix: add backwards compatibility for delete_lessons RLS policy
- `e2adfe7` ‚Äî fix: improve realtime membership stream with proper filtering
- `ff3c29f` ‚Äî fix: use single eq filter for Supabase stream
- `d537b2c` ‚Äî fix: force refresh permissions when opening lesson details

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–¥–∞—á–∞ –ø—Ä–∞–≤ –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏:**

   ```dart
   await _client.from('institution_members').insert({
     'institution_id': institution.id,
     'user_id': _userId,
     'role_name': '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å',
     'permissions': {
       'manage_students': true,      // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
       'create_lessons': true,
       'edit_own_lessons': true,
       'view_all_schedule': true,
     },
   });
   ```

2. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —ç–º–∏—Å—Å–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è:**

   ```dart
   Stream<InstitutionMember?> watchMyMembership(String institutionId) async* {
     if (_userId == null) {
       yield null;
       return;
     }

     // –°–Ω–∞—á–∞–ª–∞ —ç–º–∏—Ç–∏–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
     yield await getMyMembership(institutionId);  // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û

     // –ó–∞—Ç–µ–º —Å–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
     await for (final _ in _client.from('institution_members').stream(...)) {
       final membership = await getMyMembership(institutionId);
       yield membership;
     }
   }
   ```

3. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤:**

   ```dart
   onTap: () {
     // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –¥–µ—Ç–∞–ª–µ–π
     ref.invalidate(myMembershipProvider(institutionId));

     showModalBottomSheet(...);
   }
   ```

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `lib/features/institution/repositories/institution_repository.dart`
- `lib/features/schedule/screens/schedule_screen.dart`
- `lib/features/schedule/screens/all_rooms_schedule_screen.dart`
- `lib/shared/models/institution_member.dart`

---

## 4. –ü–æ–¥–ø–∏—Å–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ (Subscriptions)

### –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫ –≤ –ø—Ä–æ—Ñ–∏–ª–µ —É—á–µ–Ω–∏–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–æ—Å—å:
- –ù–µ –æ–±–Ω–æ–≤–ª—è–ª–æ—Å—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (Realtime –Ω–µ —Ä–∞–±–æ—Ç–∞–ª)
- –ù–µ –æ–±–Ω–æ–≤–ª—è–ª–æ—Å—å –¥–∞–∂–µ –ø–æ—Å–ª–µ pull-to-refresh

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–î–≤–æ–π–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
1. **Realtime –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω** ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `subscriptions` –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ø—É–±–ª–∏–∫–∞—Ü–∏—é `supabase_realtime`
2. **StreamProvider –Ω–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è** ‚Äî –º–µ—Ç–æ–¥ `_invalidateForStudent()` –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª `subscriptionsStreamProvider`

### –†–µ—à–µ–Ω–∏–µ

**–ö–æ–º–º–∏—Ç—ã:**
- `631ba0e` ‚Äî fix: enable realtime subscription updates in student profile
- `36d8637` ‚Äî fix: force refresh subscriptions stream after operations
- `cea1a3d` ‚Äî docs: add session report and hybrid realtime pattern documentation

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**

1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è StreamProvider:**

   ```dart
   void _invalidateForStudent(String studentId) {
     _ref.invalidate(studentSubscriptionsProvider(studentId));
     _ref.invalidate(activeSubscriptionsProvider(studentId));
     _ref.invalidate(studentActiveBalanceProvider(studentId));
     _ref.invalidate(isStudentFrozenProvider(studentId));
     // –¢–∞–∫–∂–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º StreamProvider –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
     _ref.invalidate(subscriptionsStreamProvider(studentId));  // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
   }
   ```

2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã invalidate –≤—ã–∑–æ–≤—ã –≤ UI:**

   ```dart
   // –í RefreshIndicator
   onRefresh: () async {
     ref.invalidate(studentProvider(studentId));
     ref.invalidate(studentPaymentsProvider(studentId));
     ref.invalidate(subscriptionsStreamProvider(studentId));  // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
   }

   // –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø–ª–∞—Ç—ã
   onCreated: () {
     ref.invalidate(studentProvider(studentId));
     ref.invalidate(studentPaymentsProvider(studentId));
     ref.invalidate(subscriptionsStreamProvider(studentId));  // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
   }
   ```

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è DATABASE.md:**

   ```sql
   ALTER PUBLICATION supabase_realtime ADD TABLE subscriptions;
   ```

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `lib/features/subscriptions/providers/subscription_provider.dart`
- `lib/features/students/screens/student_detail_screen.dart`
- `DATABASE.md`

---

## 5. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ

**–ö–æ–º–º–∏—Ç—ã:**
- `755bbe3` ‚Äî feat: split delete lessons permission into own/all
- `3cd11ed` ‚Äî fix: allow owner to delete any lesson

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤:**

```dart
permissions: {
  'delete_own_lessons': true,   // –ú–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ –∑–∞–Ω—è—Ç–∏—è
  'delete_all_lessons': true,   // –ú–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ –∑–∞–Ω—è—Ç–∏—è
}
```

**RLS –ø–æ–ª–∏—Ç–∏–∫–∞ —Å –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é:**
- –í–ª–∞–¥–µ–ª–µ—Ü –∑–∞–≤–µ–¥–µ–Ω–∏—è –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ –∑–∞–Ω—è—Ç–∏—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å `delete_all_lessons` –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å `delete_own_lessons` –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏
- –°—Ç–∞—Ä–æ–µ –ø—Ä–∞–≤–æ `delete_lessons` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ `delete_all_lessons` (backwards compatibility)

---

## 6. –£–ª—É—á—à–µ–Ω–∏—è UX

**–ö–æ–º–º–∏—Ç—ã:**
- `73a00bb` ‚Äî fix: preserve scroll position when returning from single room view
- `c79b5d4` ‚Äî fix: preserve exact scroll position when toggling single room view
- `8580634` ‚Äî fix: close unmarked lessons sheet after saving
- `14c05d9` ‚Äî fix: restore room sorting order in schedule
- `2b22498` ‚Äî fix: consistent scroll position in week view schedule

**–ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–∫—Ä–æ–ª–ª–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É –≤–∏–¥–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–∞–±–∏–Ω–µ—Ç–æ–≤
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞ –≤ –Ω–µ–¥–µ–ª—å–Ω–æ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏

---

## 7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ö–æ–º–º–∏—Ç:**
- `cea1a3d` ‚Äî docs: add session report and hybrid realtime pattern documentation

**–°–æ–∑–¥–∞–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ:**

1. **SESSION_2025_12_25_SUBSCRIPTIONS_REALTIME.md** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
   - –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
   - –ü–∞—Ç—Ç–µ—Ä–Ω "–ì–∏–±—Ä–∏–¥–Ω—ã–π Realtime"
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

2. **CLAUDE.md**
   - –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "5a. –ì–∏–±—Ä–∏–¥–Ω—ã–π Realtime Pattern (–í–ê–ñ–ù–û!)"
   - –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ StreamProvider
   - SQL –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Realtime
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Å—Å–∏—é –≤ —Å–ø–∏—Å–æ–∫ –ª–æ–≥–æ–≤

3. **ARCHITECTURE.md**
   - –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "–í–ê–ñ–ù–û: –ì–∏–±—Ä–∏–¥–Ω—ã–π Realtime –ø–æ–¥—Ö–æ–¥"
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
   - Best practices –¥–ª—è Realtime

4. **DATABASE.md**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `subscriptions` –≤ —Å–µ–∫—Ü–∏—é Realtime

---

## –ü–∞—Ç—Ç–µ—Ä–Ω "–ì–∏–±—Ä–∏–¥–Ω—ã–π Realtime" (–∫–ª—é—á–µ–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ)

### –°—É—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω–∞

–ö–æ–º–±–∏–Ω–∞—Ü–∏—è **Realtime Stream** + **Manual Invalidation** –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```dart
// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –í–°–ï–ì–î–ê –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–π StreamProvider
void _invalidateForEntity(String entityId) {
  _ref.invalidate(entityStreamProvider(entityId));  // ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
  _ref.invalidate(entityFutureProvider(entityId));
  _ref.invalidate(relatedDataProvider(entityId));
}

Future<Entity?> updateEntity(String id) async {
  final entity = await _repo.update(id);
  _invalidateForEntity(id);  // ‚Üê –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
  return entity;
}
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –ú–µ—Ç–æ–¥ | –ö–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç | –ó–∞—á–µ–º –Ω—É–∂–µ–Ω |
|-------|----------------|-------------|
| **Realtime Stream** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –ë–î | –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ |
| **–†—É—á–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è** | –ü–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä | –ì–∞—Ä–∞–Ω—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç Realtime |

‚úÖ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è **–≤—Å–µ–≥–¥–∞** ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ Realtime –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è **–º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** ‚Äî –∫–æ–≥–¥–∞ Realtime —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ **Pull-to-refresh** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ **–æ–ø–µ—Ä–∞—Ü–∏–π** ‚Äî create, update, delete –∏ —Ç.–¥.

### –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è Realtime streams

```dart
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (DELETE —Å–æ–±—ã—Ç–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç)
Stream<List<Entity>> watch() {
  return _client
    .from('table')
    .stream(primaryKey: ['id'])
    .eq('field', value)  // ‚Üê –§–∏–ª—å—Ç—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç DELETE
    .map(...);
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–≤—Å–µ —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç)
Stream<List<Entity>> watch() async* {
  await for (final _ in _client.from('table').stream(primaryKey: ['id'])) {
    // –ü—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º
    final data = await getAll();
    yield data;
  }
}
```

**–ü—Ä–∞–≤–∏–ª–æ:** Stream —Å–ª—É—à–∞–µ—Ç –í–°–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Ñ–∏–ª—å—Ç—Ä—É–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö.

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ö–æ–º–º–∏—Ç—ã

- **–í—Å–µ–≥–æ:** 29 –∫–æ–º–º–∏—Ç–æ–≤
- **UI/Performance:** 9
- **Realtime:** 8
- **Permissions:** 8
- **Subscriptions:** 3
- **Documentation:** 1

### –í–µ—Ä—Å–∏–∏

- **–ù–∞—á–∞–ª—å–Ω–∞—è:** 1.0.0+9
- **–ö–æ–Ω–µ—á–Ω–∞—è:** 1.0.0+13
- **TestFlight –±–∏–ª–¥–æ–≤:** 4

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–æ—Å–Ω–æ–≤–Ω—ã–µ)

1. `lib/features/schedule/screens/all_rooms_schedule_screen.dart` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞, realtime
2. `lib/features/schedule/screens/schedule_screen.dart` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞, permissions
3. `lib/features/institution/repositories/institution_repository.dart` ‚Äî realtime permissions
4. `lib/features/subscriptions/providers/subscription_provider.dart` ‚Äî realtime subscriptions
5. `lib/features/students/screens/student_detail_screen.dart` ‚Äî invalidation patterns

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–°–æ–∑–¥–∞–Ω–æ:** 1 –Ω–æ–≤—ã–π —Ñ–∞–π–ª (SESSION_2025_12_25_SUBSCRIPTIONS_REALTIME.md)
- **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 3 —Ñ–∞–π–ª–∞ (CLAUDE.md, ARCHITECTURE.md, DATABASE.md)

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

‚ö†Ô∏è **–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase SQL Editor:**

```sql
ALTER PUBLICATION supabase_realtime ADD TABLE subscriptions;
```

–ë–µ–∑ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ (pull-to-refresh), –Ω–æ –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–∫—Ä–æ–ª–ª –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏
1. –û—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É "–ù–µ–¥–µ–ª—è"
2. –°–∫—Ä–æ–ª–ª–∏—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ (–∫–∞–±–∏–Ω–µ—Ç—ã)
3. ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫ –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
4. ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Realtime —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –æ—Ç–∫—Ä—ã–ª —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B –¥–æ–±–∞–≤–∏–ª/—É–¥–∞–ª–∏–ª/–∏–∑–º–µ–Ω–∏–ª –∑–∞–Ω—è—Ç–∏–µ
3. ‚úÖ –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è A –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –∑–∞–≤–µ–¥–µ–Ω–∏—é –ø–æ –∫–æ–¥—É
2. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏–ª –ø—Ä–∞–≤–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞–º–∏
3. –í–ª–∞–¥–µ–ª–µ—Ü –∏–∑–º–µ–Ω–∏–ª –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. ‚úÖ –ü—Ä–∞–≤–∞ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü–æ–¥–ø–∏—Å–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —É—á–µ–Ω–∏–∫–∞
2. –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
3. ‚úÖ –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–±–Ω–æ–≤–∏–ª–∞—Å—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
4. ‚úÖ Pull-to-refresh —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ú—É–ª—å—Ç–∏—é–∑–µ—Ä –ø–æ–¥–ø–∏—Å–∫–∏
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –æ—Ç–∫—Ä—ã–ª –ø—Ä–æ—Ñ–∏–ª—å —É—á–µ–Ω–∏–∫–∞
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B –ø—Ä–æ–¥–ª–∏–ª –ø–æ–¥–ø–∏—Å–∫—É —ç—Ç–æ–º—É —É—á–µ–Ω–∏–∫—É
3. ‚úÖ –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è A –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å (–µ—Å–ª–∏ Realtime –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

---

## –í—ã–≤–æ–¥—ã –∏ —É—Ä–æ–∫–∏

### 1. StreamProvider –Ω—É–∂–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å
StreamProvider –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ –∫–æ–º–∞–Ω–¥–µ. –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π –≤ –º–µ—Ç–æ–¥ `_invalidate*()`:
```dart
_ref.invalidate(entityStreamProvider(id));
```

### 2. Realtime —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å `.stream()` –≤ –∫–æ–¥–µ. –¢–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:
```sql
ALTER PUBLICATION supabase_realtime ADD TABLE table_name;
```

### 3. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –Ω–∞–¥–µ–∂–Ω–µ–µ
–ö–æ–º–±–∏–Ω–∞—Ü–∏—è Realtime + manual invalidation –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ –ª—é–±–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.

### 4. DELETE —Å–æ–±—ã—Ç–∏—è —Ç—Ä–µ–±—É—é—Ç –æ—Å–æ–±–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
–§–∏–ª—å—Ç—Ä—ã –≤ `.stream()` –±–ª–æ–∫–∏—Ä—É—é—Ç DELETE —Å–æ–±—ã—Ç–∏—è. –°–ª—É—à–∞–π –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Ñ–∏–ª—å—Ç—Ä—É–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.

### 5. Permissions —Ç—Ä–µ–±—É—é—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π —ç–º–∏—Å—Å–∏–∏
Stream –¥–æ–ª–∂–µ–Ω —ç–º–∏—Ç–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ü–ï–†–ï–î –ø–æ–¥–ø–∏—Å–∫–æ–π –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∏–Ω–∞—á–µ UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç null.

### 6. ClampingScrollPhysics = –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫
–î–ª—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ —Å–≤–∞–π–ø—ã –∏—Å–ø–æ–ª—å–∑—É–π ClampingScrollPhysics –≤–º–µ—Å—Ç–æ default.

### 7. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å—Ä–∞–∑—É
–î–æ–±–∞–≤–ª—è–π –Ω–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ CLAUDE.md –∏ ARCHITECTURE.md, –ø–æ–∫–∞ –æ–Ω–∏ —Å–≤–µ–∂–∏ –≤ –ø–∞–º—è—Ç–∏.

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∫–æ–º–∞–Ω–¥—É –¥–ª—è Realtime subscriptions
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ 4 TestFlight –±–∏–ª–¥–∞
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
4. üîÑ –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
5. üîÑ –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## –ö–æ–º–º–∏—Ç—ã

```bash
# Scroll performance (builds 10-13)
5b89a89 fix: remove scroll animation delay in schedule views
c0cc07d build: bump version to 1.0.0+10
82612a2 fix: add ClampingScrollPhysics to all vertical scrolls
3316af4 build: bump version to 1.0.0+11
9d34182 fix: enable scrolling on all week view rows with synchronization
828df98 build: bump version to 1.0.0+12
024d2fa fix: synchronize week view header with day rows scrolling
3294744 build: bump version to 1.0.0+13

# Realtime sync
0843fa2 feat: realtime schedule updates and navigation fix
e3e8856 fix: force schedule refresh after lesson delete/update
8d0faa9 fix: realtime sync for lesson deletions across users
4e5385e fix: remove filters from Supabase Realtime streams
b076839 fix: implement realtime member permissions updates
631ba0e fix: enable realtime subscription updates in student profile

# Permissions
bebc87b feat: auto-grant student management permission on join
755bbe3 feat: split delete lessons permission into own/all
3cd11ed fix: allow owner to delete any lesson
671f298 fix: emit initial membership value before listening to changes
ecbfda7 fix: use direct Supabase access for currentUserId
da18dcb fix: add backwards compatibility for delete_lessons RLS
e2adfe7 fix: improve realtime membership stream with filtering
ff3c29f fix: use single eq filter for Supabase stream
d537b2c fix: force refresh permissions when opening lesson details

# Subscriptions
36d8637 fix: force refresh subscriptions stream after operations

# UX improvements
73a00bb fix: preserve scroll position returning from single room
c79b5d4 fix: preserve exact scroll position toggling view
8580634 fix: close unmarked lessons sheet after saving
14c05d9 fix: restore room sorting order in schedule
2b22498 fix: consistent scroll position in week view

# Documentation
cea1a3d docs: add session report and hybrid realtime pattern
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏ –∑–∞–ø—É—à–µ–Ω—ã
**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∫–æ–º–∞–Ω–¥—É –≤ Supabase –¥–ª—è Realtime subscriptions
**–î–∞—Ç–∞:** 25.12.2025
